\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{rahul}[2017/03/23 new commands and stuff]

\RequirePackage{amsmath,amssymb,amsthm}
\RequirePackage{bbm}
\RequirePackage{mathtools}
\RequirePackage{algpseudocode}
\RequirePackage{microtype}

% Fix Math {{{

\DeclareMathOperator{\lcm}{lcm}
\DeclareMathOperator{\Vol}{Vol}
\DeclareMathOperator{\Tr}{Tr}

% fix spacing with \left and \right
\let\originalleft\left
\let\originalright\right
\renewcommand{\left}{\mathopen{}\mathclose\bgroup\originalleft}
\renewcommand{\right}{\aftergroup\egroup\originalright}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}
\DeclarePairedDelimiter\norm{\lVert}{\rVert}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}

\let\oldabs\abs
\def\abs{\@ifstar{\oldabs}{\oldabs*}}
%
\let\oldnorm\norm
\def\norm{\@ifstar{\oldnorm}{\oldnorm*}}
\makeatother
%
\makeatletter
\let\oldceil\ceil
\def\ceil{\@ifstar{\oldceil}{\oldceil*}}
%
\let\oldfloor\floor
\def\floor{\@ifstar{\oldfloor}{\oldfloor*}}

\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}

\newcommand{\pd}[2][]{\frac{\partial#1}{\partial#2}}
\newcommand{\dd}[1]{\,\textrm d{#1}}
\newcommand{\de}[2][]{\frac{\mathrm d{#1}}{\mathrm d{#2}}}

\let\oldhat\hat
\renewcommand{\hat}[1]{\vphantom{#1}\smash[t]{\oldhat{#1}}}

% }}}

% Probability {{{

\newcommand\given[1][]{\:\ifnum\currentgrouptype=16\middle\fi|\:}

\newcommand\indep{\protect\mathpalette{\protect\indephelper}{\perp}}
\def\indephelper#1#2{\mathrel{\rlap{$#1#2$}\mkern4mu{#1#2}}}

\newcommand{\E}[2][]{\mathbb{E}_{#1}\left[#2\right]}
\renewcommand{\Pr}[1]{\mathbb{P}\left[#1\right]}
\newcommand{\Var}[2][]{\textsf{Var}_{#1}\left[#2\right]}
\newcommand{\Cov}[2][]{\textsf{Cov}_{#1}\left[#2\right]}
\newcommand{\I}[1]{\mathbbm{1}_{#1}}

\DeclareMathOperator{\IID}{IID}
\DeclareMathOperator{\Ber}{Ber}
\DeclareMathOperator{\Geo}{Geo}
\DeclareMathOperator{\N}{\mathcal{N}}
\DeclareMathOperator{\U}{\mathcal{U}}
\DeclareMathOperator{\Exp}{Exp}
\DeclareMathOperator{\Pareto}{Pareto}
\DeclareMathOperator{\Laplace}{Laplace}

% }}}

% Algorithms {{{

\newcommand{\alg}[1]{\textsc{#1}}

\algnewcommand\True{\textbf{true}\space}
\algnewcommand\False{\textbf{false}\space}

\algnewcommand{\LineComment}[1]{\State \(\triangleright\) #1}

\makeatletter
\newcommand{\algmargin}{\the\ALG@thistlm}
\makeatother
\newlength{\whilewidth}
\settowidth{\whilewidth}{\algorithmicwhile\ }
\algdef{SE}[parWHILE]{parWhile}{EndparWhile}[1]
  {\parbox[t]{\dimexpr\linewidth-\algmargin}{%
     \hangindent\whilewidth\strut\algorithmicwhile\ #1\ \algorithmicdo\strut}}{\algorithmicend\ \algorithmicwhile}%
\algnewcommand{\parState}[1]{\State%
  \parbox[t]{\dimexpr\linewidth-\algmargin}{\strut #1\strut}}

% }}}

% Misc {{{

\makeatletter
\newcommand{\skipitems}[1]{%
  \addtocounter{\@enumctr}{#1}%
}
\makeatother

% }}}
